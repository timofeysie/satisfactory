# July Work

## Todo

- selected generated image broken
- Lindsey Graham generated image not uploaded to s3
- make post creation from stack at responsive width
- make sections collapsible
- make sections stack-able
- scrollbar cropping function
- story type generation
- set the author name from the logged in user
- replace demo server with nest server for login
- use author name plus id of model for generated image names

## Scrollbar cropper

### Previous notes from last month

Make sure the cropped scroll area is the same ratio as the cropped aspect.

The image should be full sized but scaled as the cropped image is.

After the user drags around the image to center it, they can choose a generate posters button that will kick off the model.

To create the correct size, we can use the same functions, except using the UI width as the desired width, and calculating the new height based on the desired width.

Create variables for these fixed lengths:

```js
  maxPortraitHeight = 960;
  maxLandscapeHeight = 541;
  maxDisplayPortraitHeight = 100;
  maxDisplayLandscapeHeight = 100;
```

The second two can be used to create display sizes.

First, convert the calculated sizes to display sizes the user can play with.

When the user wants to generate an aspect image, convert those display sizes back to calculated sizes to generate the poster images from.

Sounds like a few more weeks of work, to be continued next month.

### The action flow

Currently:

1. ngOnInit() listens to the _imageFileName BehaviorSubject
2. An image is chosen and setupPosters(fileName, sharpMetadata, 'portrait') gets the meta data
3. setupPosters calls trendsService.postImageMetadata for each aspect
4. the postImageMetadata service prepares a cropped poster aspect images from the original
5. preparePostBody determines the width and the height and calculates the aspect of the posters
6. setAspectData(newFileName, aspect, body) sets <aspect>Data and <aspect>Img for display

To create the scrolling offset creator images, we need to repeat step 5, but with new limitations for the smaller images to display.  So we need to create a new function from preparePostBody called something like prepareImagePreview.

prepareImagePreview or create imagePreview or something like that.

Here is the current API for that function:

preparePostBody(fileName: string, aspect: string, _metaData: any)

We want to use the created file data for an aspect instead of the original metaData, and calculate a set of new sizes for display, because we don't want to display the original image in the small 100px x auto display scroll container.

We don't need to calculate offsets I think, as they are already done for us.  Or do we need new miniturized offsets?  Yes, I think we do.  The offsets are for the posters from the original.

We needs display w/h and display x/y offsets.  I think I need to draw this out to understand the requirements here.  In the meantime, I might just let the user enter offsets manually and then regenerate the images from those.  Really, we have to get to generating the story.  Now we have posters, it's time to move on that.

### Using the max display heights

What was this for?

## Lindsey Graham generated image not uploaded to s3

## Input file is missing

file un-encoded
ImageService.findOne: imagePath dist/apps/public/Rybakina_RG19_(4)_(48199109407).jpg
(node:18260) UnhandledPromiseRejectionWarning: Error: Input file is missing: dist/apps/public/Rybakina_RG19_(4)_(48199109407).jpg

The encode/don't encode issue is still a thing.

This file is showing up as "file un-encoded".

And the images are not loading once encoded:

Request URL: http://localhost:3333/public/Rybakina_RG19_%284%29_%2848199109407%29-portrait.jpg
Request Method: GET
Status Code: 404 Not Found

The actual filename is:
Rybakina_RG19_%284%29_%2848199109407%29-portrait.jpg

And the frontend is looking for:
Rybakina_RG19_%284%29_%2848199109407%29-portrait.jpg

Looks the same to me.

Request URL: http://localhost:3333/public/Rybakina_RG19_%25284%2529_%252848199109407%2529.jpg
Request Method: GET
Status Code: 200 OK

Since this works:

Rybakina_RG19_(4)_(48199109407).jpg (downloaded)
Rybakina_RG19_%25284%2529_%252848199109407%2529.jpg (original)
Rybakina_RG19_%284%29_%2848199109407%29-portrait.jpg

(4) => %25284%2529 or %284%29

That when we don't use the encoding.

When we do use this encoding method:

encodedFileName = encodeURIComponent(imageName);
encodedFileName = this.encodeUriAll(encodedFileName);

Then the files are generated, just not shown.  Even the Drake example wont be shown.
